<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Mappa con Cluster</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
        .custom-cluster {
            background: rgba(0, 123, 255, 0.8);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .custom-marker {
            background: rgba(255, 99, 71, 0.8);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        // Inizializza la mappa
        const map = L.map('map').setView([45.4642, 9.1900], 8);

        // Aggiungi un livello base (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Dati dei negozi
        const stores = [
            { name: "Verona", lat: 45.407203, lng: 10.964957, link: "/negozi/verona" },
            { name: "Treviso - Montebelluna", lat: 45.778894, lng: 12.060182, link: "/negozi/treviso" },
            { name: "Pordenone - Fiume Veneto", lat: 45.94545, lng: 12.717415, link: "/negozi/pordenone" },
            { name: "Gorizia", lat: 45.92938, lng: 13.624, link: "/negozi/gorizia" },
            { name: "Trieste", lat: 45.619379, lng: 13.811839, link: "/negozi/trieste" },
            { name: "Udine - Tavagnacco", lat: 46.110939, lng: 13.227786, link: "/negozi/udine" },
            { name: "Brescia - San Zeno sul Naviglio", lat: 45.496263, lng: 10.218256, link: "/negozi/brescia" },
            { name: "Brescia - Rovato", lat: 45.5775316, lng: 10.0093619, link: "/negozi/brescia-rovato" },
            { name: "Padova", lat: 45.413944, lng: 11.919801, link: "/negozi/padova" },
            { name: "Venezia - Marcon", lat: 45.547356, lng: 12.310867, link: "/negozi/venezia" },
            { name: "Venezia - San Dona di Piave", lat: 45.63907, lng: 12.59397, link: "/negozi/sandona" },
            { name: "Bergamo", lat: 45.668885, lng: 9.638014, link: "/negozi/bergamo" },
            { name: "Vicenza", lat: 45.529185, lng: 11.498584, link: "/negozi/vicenza" },
            { name: "Bologna", lat: 44.5198454, lng: 11.3617676, link: "/negozi/bologna" },
            { name: "Reggio Emilia", lat: 44.7112067, lng: 10.6172083, link: "/negozi/reggio-emilia" },
            { name: "Como", lat: 45.7632796, lng: 9.0558871, link: "/negozi/como" },
            { name: "Torino - Chivasso", lat: 45.20136, lng: 7.893376, link: "/negozi/chivasso" },
            { name: "Cremona", lat: 45.1340326, lng: 10.0380331, link: "/negozi/cremona" },
            { name: "Verona - Castelnuovo del Garda", lat: 45.4377419, lng: 10.7527042, link: "/negozi/castelnuovo-del-garda" },
            { name: "Milano - Rozzano", lat: 45.380344, lng: 9.1687192, link: "/negozi/rozzano" },
            { name: "Sondrio - Castione Andevenno", lat: 46.162859, lng: 9.811668, link: "/negozi/sondrio" },
            { name: "Treviso - San Fior", lat: 45.9053281, lng: 12.3362322, link: "/negozi/san-fior-treviso" },
            { name: "Milano - Baranzate", lat: 45.533447, lng: 9.107669, link: "/negozi/baranzate-milano" }
        ];

        // Crea un gruppo di cluster
        const markers = L.markerClusterGroup({
            iconCreateFunction: function(cluster) {
                const count = cluster.getChildCount();
                return L.divIcon({
                    html: `<div class='custom-cluster'>${count}</div>`,
                    className: 'custom-cluster',
                    iconSize: [40, 40]
                });
            }
        });

        // Aggiungi i marker al cluster
        stores.forEach(store => {
            const customIcon = L.divIcon({
                html: `<div class='custom-marker'>üìç</div>`,
                className: 'custom-marker',
                iconSize: [30, 30]
            });
            const marker = L.marker([store.lat, store.lng], { icon: customIcon })
                .bindPopup(`<b>${store.name}</b><br><a href="${store.link}" target="_blank">Scopri di pi√π</a>`);
            markers.addLayer(marker);
        });

        // Aggiungi i cluster alla mappa
        map.addLayer(markers);
    </script>
</body>
</html>
